-- 뷰 

/*
■ 뷰의 쓰임새
본인 부서에서 보고싶은 정보가 각각 고객과 주문테이블을 조인해야 하는데
이걸 매번 JOIN하기 너무 어려우니 ‘뷰’라는 가상테이블을 만들 수 있음\

■ 장점: *해도 뷰는 내가 선언한 컬럼들만 조회됨 -> 보완측에서 굉장히 좋음

■ 뷰 생성
• 형식1: OR REPLACE 사용 -> 주로 뷰 사용 
• 형식2: ALTER 사용
*/

USE WNTRADE;

-- _______________________________사원 뷰 ____________________________________________________________________________________________________-
SELECT * FROM 사원;

CREATE OR REPLACE VIEW 사원_여자
AS
SELECT 
이름
,집전화
,입사일
,주소
,성별
FROM 사원
WHERE 성별 = '여'
WITH CHECK OPTION;

SELECT * FROM 사원_여자;

INSERT INTO 사원_여자(사원번호,이름, 집전화, 입사일, 주소, 성별)
VALUES
('E17','신봄','(02)587-4989','2023-02-10','서울시 강남구 청담동 23-5','남'); -- ERROR WITH CHECK OPTION에 막힘 
-- ('E14','황여름','(02)587-4989','2023-02-10','서울시 강남구 청담동 23-5','여');
-- ('E17','신봄','(02)587-4989','2023-02-10','서울시 강남구 청담동 23-5','남');
-- 오류가 나는 이유 원본테이블에 프라이머리키가 사원번호인데 사원번호가 없음
-- 계속 오류가 나오면 프라이머리키가 원본테이블에 이미 있는지 확인 


CREATE OR REPLACE VIEW 사원_여자
AS
SELECT
사원번호 
,이름
,집전화
,입사일
,주소
,성별
FROM 사원
WHERE 성별 = '여'
WITH CHECK OPTION;



-- 제품 별 주문수량 합 ________________________________________________________________
SELECT * FROM 주문세부;

CREATE OR REPLACE VIEW 제품주문수량
AS
SELECT
제품명
,SUM(주문수량) AS '제품별 주문수량 합'

FROM 제품
INNER JOIN 주문세부
ON 제품.제품번호 = 주문세부.제품번호 
GROUP BY 제품.제품번호;

SELECT * FROM 제품주문수량;

INSERT INTO 제품주문수량
VALUES('단짠 새우깡', 250); 
-- 뷰 테이블에 데이터를 넣는다고 하더라고 프라이머리키가 없음 

-- 뷰 : 가상의 

-- ______________________인덱스 (바로가기)___________________________________________
-- 테이블에 붙여주는 거임
-- 보조인덱스, 복합인덱스 과 사용시 비용이 많이 듦 
-- 구성 : 기본인덱스(PK) + 보조인덱스(0..N)
-- 복합 : 2개 이상의 컬럼으로 구성, AND, %로 시작하면 X 

USE 분석실습;
SELECT * FROM SALES;

CREATE OR REPLACE VIEW SALES_SUMMARY
AS 
SELECT
Country,
StockCode,
SUM(Quantity) as total_quantity,
SUM(Quantity*UnitPrice) as total_sales
FROM sales
Group by Country, StockCode;

SELECT * FROM sales_summary
where country = 'United kingdom';

show index from sales;
 
 -- 인덱스 생성
 create index idx_customer_date on sales(CustomerID, InvoiceDate);
 
 -- 인덱스 삭제
 alter table sales drop index idx_customer_date;
 
 explain analyze
 select * from sales
 where customerID like '%17850' and InvoiceDate >= '2010-12-01';


-- 옵티마이저( 쿼리의 실행 계획을 결정하는 역할을 함)
-- 9-12 
select * from sales;

explain format = tree
select * from sales
 where customerID like '%17850' and InvoiceDate >= '2010-12-01';
 group by 536365
 
 
INSERT INTO 사원_여자(사원번호,이름, 집전화, 입사일, 주소, 성별)
VALUES
('E17','신봄','(02)587-4989','2023-02-10','서울시 강남구 청담동 23-5','남');
 insert into
 values('2022', '12',20,'서울',21.5, 21);
 
 
 -- 연습 ---------------------------------------------------
 CREATE TABLE 날씨
(
    년도 INT
    , 월 INT
    , 일 INT
    , 도시 VARCHAR(20)
    , 기온 NUMERIC(3, 1)
    , 습도 INT
    , PRIMARY KEY(년도, 월, 일, 도시)
    , INDEX 기온인덱스(기온)
    , INDEX 도시인덱스(도시)
);

INSERT INTO 날씨
VALUES
('2022', '12', '13', '서울', 19.8, 17),
('2023', '11', '25', '부산', 18.2, 22),
('2022', '10', '07', '인천', 23.5, 19),
('2023', '03', '17', '대구', 15.1, 21),
('2024', '06', '29', '서울', 20.4, 25),
('2022', '07', '03', '부산', 17.6, 18),
('2024', '08', '15', '인천', 24.3, 20),
('2023', '09', '12', '대구', 21.7, 23),
('2022', '04', '10', '서울', 16.9, 20),
('2024', '05', '21', '부산', 22.1, 19),
('2023', '12', '14', '인천', 19.3, 21),
('2022', '01', '18', '대구', 13.7, 18),
('2024', '03', '19', '서울', 21.2, 22),
('2022', '02', '11', '부산', 16.5, 20),
('2023', '10', '27', '인천', 23.0, 24),
('2024', '07', '09', '대구', 18.8, 17),
('2022', '06', '30', '서울', 20.6, 23),
('2023', '08', '05', '부산', 17.3, 19),
('2024', '09', '14', '인천', 24.7, 20),
('2022', '03', '08', '대구', 15.9, 21),
('2023', '05', '15', '서울', 22.4, 18),
('2024', '12', '20', '부산', 19.1, 22),
('2022', '11', '22', '인천', 23.2, 20),
('2023', '02', '04', '대구', 14.8, 17),
('2024', '04', '07', '서울', 20.3, 19),
('2022', '08', '26', '부산', 16.1, 24),
('2023', '06', '16', '인천', 22.8, 21),
('2024', '01', '23', '대구', 13.9, 18),
('2022', '09', '28', '서울', 18.7, 23),
('2023', '07', '02', '부산', 17.8, 19);

INSERT INTO 날씨 VALUES
('2022', '07', '21', '서울', 22.7, 20),
('2023', '02', '18', '부산', 17.5, 23),
('2024', '11', '13', '인천', 21.2, 19),
('2022', '03', '29', '대구', 15.3, 24),
('2023', '08', '04', '서울', 19.4, 22),
('2024', '06', '17', '부산', 20.1, 18),
('2022', '12', '09', '인천', 18.8, 20),
('2023', '01', '27', '대구', 16.9, 21),
('2024', '04', '14', '서울', 23.3, 19),
('2022', '09', '07', '부산', 20.2, 17),
('2023', '05', '11', '인천', 22.5, 21),
('2024', '10', '26', '대구', 17.6, 22),
('2022', '08', '12', '서울', 21.4, 18),
('2023', '03', '16', '부산', 18.9, 19),
('2024', '12', '22', '인천', 19.8, 23),
('2022', '11', '05', '대구', 13.5, 18),
('2023', '07', '23', '서울', 24.1, 20),
('2024', '01', '18', '부산', 15.7, 21),
('2022', '06', '08', '인천', 22.9, 19),
('2023', '10', '28', '대구', 18.4, 24),
('2024', '08', '02', '서울', 23.7, 17),
('2022', '04', '20', '부산', 19.3, 22),
('2023', '12', '10', '인천', 21.0, 20),
('2024', '05', '06', '대구', 20.8, 19),
('2022', '10', '15', '서울', 18.3, 18),
('2023', '06', '19', '부산', 21.9, 21),
('2024', '02', '21', '인천', 17.1, 20),
('2022', '07', '30', '대구', 14.7, 22),
('2023', '09', '13', '서울', 23.4, 19),
('2024', '03', '24', '부산', 16.3, 18),
('2022', '12', '02', '인천', 20.5, 23),
('2023', '01', '09', '대구', 15.2, 21),
('2024', '04', '15', '서울', 22.0, 22),
('2022', '08', '18', '부산', 17.8, 20),
('2023', '11', '07', '인천', 18.6, 19),
('2024', '06', '23', '대구', 21.5, 23),
('2022', '05', '14', '서울', 19.0, 18),
('2023', '10', '29', '부산', 22.8, 22),
('2024', '07', '16', '인천', 24.6, 20),
('2022', '03', '12', '대구', 14.2, 19),
('2023', '12', '27', '서울', 20.1, 23),
('2024', '01', '08', '부산', 16.2, 17),
('2022', '06', '13', '인천', 18.7, 22),
('2023', '09', '05', '대구', 20.6, 21),
('2024', '08', '26', '서울', 23.0, 19),
('2022', '04', '04', '부산', 21.6, 18),
('2023', '11', '30', '인천', 19.5, 20),
('2024', '05', '29', '대구', 22.3, 23),
('2022', '07', '17', '서울', 21.2, 19),
('2023', '02', '02', '부산', 17.0, 20),
('2024', '10', '21', '인천', 22.4, 21),
('2022', '09', '09', '대구', 15.5, 17),
('2023', '06', '20', '서울', 18.5, 22),
('2024', '03', '02', '부산', 19.7, 18),
('2022', '12', '21', '인천', 20.3, 19),
('2023', '08', '01', '대구', 21.9, 21),
('2024', '06', '04', '서울', 23.6, 23),
('2022', '05', '23', '부산', 15.9, 19),
('2023', '10', '18', '인천', 17.4, 18),
('2024', '01', '25', '대구', 13.8, 17),
('2022', '03', '03', '서울', 20.9, 22),
('2023', '12', '12', '부산', 18.2, 23),
('2024', '09', '27', '인천', 19.6, 20),
('2022', '04', '22', '대구', 16.4, 21),
('2023', '11', '11', '서울', 22.2, 19),
('2024', '07', '19', '부산', 20.7, 18),
('2022', '08', '27', '인천', 21.3, 22),
('2023', '01', '19', '대구', 17.7, 20),
('2024', '05', '12', '서울', 18.0, 21),
('2022', '10', '31', '부산', 20.0, 23),
('2023', '06', '01', '인천', 24.0, 19),
('2024', '02', '14', '대구', 19.9, 22),
('2022', '07', '13', '서울', 17.3, 18),
('2023', '09', '22', '부산', 22.6, 21),
('2024', '11', '15', '인천', 16.5, 20),
('2022', '03', '18', '대구', 21.1, 17),
('2023', '12', '06', '서울', 19.2, 22),
('2024', '06', '25', '부산', 23.9, 19),
('2022', '05', '20', '인천', 20.7, 18),
('2023', '10', '23', '대구', 18.1, 21),
('2024', '01', '04', '서울', 15.1, 17),
('2022', '09', '02', '부산', 24.8, 23),
('2023', '06', '11', '인천', 18.3, 20),
('2024', '03', '13', '대구', 20.2, 22),
('2022', '12', '30', '서울', 22.6, 19),
('2023', '08', '24', '부산', 21.8, 19),
('2024', '05', '28', '인천', 19.4, 18),
('2022', '11', '17', '대구', 16.8, 21),
('2023', '01', '21', '서울', 23.1, 20),
('2024', '08', '12', '부산', 21.7, 22),
('2022', '04', '27', '인천', 18.5, 23),
('2023', '10', '09', '대구', 15.6, 18),
('2024', '07', '23', '서울', 20.4, 17),
('2022', '05', '04', '부산', 24.4, 21),
('2023', '11', '28', '인천', 23.8, 19),
('2024', '02', '20', '대구', 14.9, 22),
('2022', '08', '20', '서울', 19.6, 19),
('2023', '12', '17', '부산', 17.2, 20),
('2024', '04', '18', '인천', 22.3, 21),
('2022', '06', '07', '대구', 13.6, 23),
('2023', '09', '30', '서울', 21.5, 20),
('2024', '10', '02', '부산', 18.7, 19),
('2022', '03', '21', '인천', 20.8, 18),
('2023', '07', '15', '대구', 17.4, 22),
('2024', '01', '14', '서울', 16.6, 23),
('2022', '10', '23', '부산', 22.7, 17),
('2023', '06', '26', '인천', 19.0, 22),
('2024', '05', '15', '대구', 18.3, 21),
('2022', '12', '04', '서울', 15.8, 18),
('2023', '08', '20', '부산', 23.2, 23),
('2024', '11', '05', '인천', 16.1, 17),
('2022', '04', '01', '대구', 14.5, 22),
('2023', '01', '15', '서울', 21.9, 20),
('2024', '07', '13', '부산', 24.5, 19),
('2022', '09', '27', '인천', 19.7, 21),
('2023', '05', '31', '대구', 18.5, 20),
('2024', '02', '11', '서울', 21.0, 17),
('2022', '07', '03', '부산', 17.9, 18),
('2023', '10', '19', '인천', 24.2, 22),
('2024', '06', '22', '대구', 20.3, 23),
('2022', '03', '11', '서울', 17.1, 19),
('2023', '12', '23', '부산', 19.1, 21),
('2024', '05', '24', '인천', 18.6, 18),
('2022', '10', '10', '대구', 22.4, 21),
('2023', '06', '21', '서울', 23.3, 17),
('2024', '03', '29', '부산', 15.5, 19),
('2022', '09', '08', '인천', 20.6, 22),
('2023', '01', '26', '대구', 13.7, 23),
('2024', '08', '17', '서울', 19.8, 20),
('2022', '05', '17', '부산', 22.9, 17),
('2023', '11', '24', '인천', 18.9, 19),
('2024', '07', '26', '대구', 21.4, 18),
('2022', '12', '18', '서울', 14.4, 23),
('2023', '08', '22', '부산', 24.3, 21),
('2024', '02', '05', '인천', 19.5, 22),
('2022', '04', '25', '대구', 17.2, 17),
('2023', '10', '31', '서울', 16.8, 18),
('2024', '06', '11', '부산', 18.0, 20),
('2022', '09', '11', '인천', 20.1, 19),
('2023', '05', '19', '대구', 21.2, 21),
('2024', '01', '09', '서울', 15.4, 23),
('2022', '07', '19', '부산', 19.9, 22),
('2023', '12', '05', '인천', 18.4, 17),
('2024', '03', '10', '대구', 17.5, 18),
('2022', '10', '13', '서울', 23.6, 21),
('2023', '06', '23', '부산', 20.3, 20),
('2024', '09', '07', '인천', 24.1, 19),
('2022', '03', '26', '대구', 16.0, 22),
('2023', '11', '09', '서울', 22.5, 23),
('2024', '05', '22', '부산', 19.7, 18),
('2022', '08', '28', '인천', 21.6, 22),
('2023', '01', '13', '대구', 14.1, 19),
('2024', '04', '06', '서울', 15.6, 20),
('2022', '12', '15', '부산', 17.3, 21),
('2023', '07', '12', '인천', 22.3, 18),
('2024', '02', '17', '대구', 18.2, 23),
('2022', '05', '10', '서울', 19.3, 21),
('2023', '10', '15', '부산', 22.1, 17),
('2024', '08', '21', '인천', 18.7, 19),
('2022', '04', '16', '대구', 16.7, 20),
('2023', '12', '01', '서울', 21.5, 22),
('2024', '06', '28', '부산', 23.0, 20),
('2022', '09', '04', '인천', 17.0, 21),
('2023', '05', '09', '대구', 18.8, 18),
('2024', '01', '22', '서울', 16.9, 17),
('2022', '07', '25', '부산', 21.8, 23),
('2023', '11', '14', '인천', 24.9, 22),
('2024', '04', '27', '대구', 19.4, 18),
('2022', '10', '20', '서울', 22.4, 19),
('2023', '06', '25', '부산', 19.0, 20),
('2024', '09', '10', '인천', 18.5, 21),
('2022', '03', '25', '대구', 14.3, 17),
('2023', '12', '25', '서울', 17.2, 18),
('2024', '05', '27', '부산', 22.6, 21),
('2022', '08', '14', '인천', 20.3, 22),
('2023', '01', '30', '대구', 15.0, 21),
('2024', '02', '07', '서울', 18.1, 19),
('2022', '06', '19', '부산', 23.3, 20),
('2023', '10', '25', '인천', 16.7, 23),
('2024', '07', '21', '대구', 20.6, 22);


drop table 날씨;

SHOW INDEX FROM 날씨;

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 년도 = 2023 and 일 > 1 ;

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 년도 = 2023 and 월  > 1 ;

EXPLAIN ANALYZE
SELECT * FROM 날씨 force index(기온인덱스)
WHERE 기온 BETWEEN 10 AND 20;

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 기온 BETWEEN 10 AND 20;

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 도시 LIKE '서울%';

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 년도=2023 AND 월=6 AND 도시 LIKE '서울';

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 년도 = 2023 AND 월 = 6 AND 일 > 1 AND 도시 = '서울';

EXPLAIN ANALYZE
SELECT * FROM 날씨
WHERE 년도=2023 AND 월=6 AND 도시 LIKE '서울%';

/*

번호	조건	INDEX 사용 여부
①	WHERE 년도 = 2023 AND 월 = 6;	 가능 - 기본인덱스 
②	WHERE 년도 = 2023 OR 월 = 6;	불가능 
③	WHERE 년도 = 2023 AND 일 > 1;	월이 없어서 필터가 들어가기 때문에 안탄다고 봐야함 
④	WHERE 기온 BETWEEN 10 AND 20;	 가능 - 인덱스 탐 
⑤	WHERE 월 = 6 AND 일 > 1;	불가능 
⑥	WHERE 기온 >= 10 AND 습도 >= 20; 일부 가능	기온만 
⑦	WHERE 기온 >= 10 OR 습도 >= 20; 불가능 	
⑧	WHERE 도시 = '서울';	가능 
⑨	WHERE 도시 LIKE '서울%';	가능 
⑩	WHERE 도시 LIKE '%서울%';	불가능 
⑪	WHERE 년도 = 2023 AND 월 = 6 AND 일 > 1 AND 도시 = '서울';	가능
⑫	WHERE 년도 = 2023 AND 월 = 6 AND 일 > 1 AND 도시 LIKE '서울%'; 가능 

*/


 